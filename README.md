# –¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –ò–º–∏—Ç–∞—Ü–∏—è webhook –æ—Ç –±–∞–Ω–∫–∞

## –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏

–°–µ—Ä–≤–∏—Å –Ω–∞ Django –ø—Ä–∏–Ω–∏–º–∞–µ—Ç webhook-–∏ –æ—Ç –±–∞–Ω–∫–∞, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—á–∏—Å–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ –ò–ù–ù, –∑–∞—â–∏—â—ë–Ω –æ—Ç –¥—É–±–ª–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

### –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:

- **POST `/api/v1/webhook/bank/`**  
  –ü—Ä–∏–Ω–∏–º–∞–µ—Ç JSON —Ñ–æ—Ä–º–∞—Ç–∞:
  ```json
  {
    "operation_id": "ccf0a86d-041b-4991-bcf7-e2352f7b8a4a",
    "amount": 145000,
    "payer_inn": "1234567890",
    "document_number": "PAY-328",
    "document_date": "2024-04-27T21:00:00Z"
  }
  ```
–ü–æ–≤–µ–¥–µ–Ω–∏–µ
–ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è —É–∂–µ –±—ã–ª–∞ (operation_id) ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK –¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π, —Ç–æ –µ—Å—Ç—å –µ—Å–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π –≤–µ–±—Ö—É–∫, –º—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –∑–∞–Ω–æ–≤–æ –ø–æ–ø–æ–ª–Ω—è—Ç—å –±–∞–ª–∞–Ω—Å
–ï—Å–ª–∏ –Ω–æ–≤–∞—è:
—Å–æ–∑–¥–∞—ë—Ç Payment
–Ω–∞—á–∏—Å–ª—è–µ—Ç —Å—É–º–º—É –Ω–∞ –±–∞–ª–∞–Ω—Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å payer_inn
–ª–æ–≥–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ (–≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ print / log)
üßæ GET /api/v1/organizations/<inn>/balance/
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ –ò–ù–ù:
  ```json
{
  "inn": "1234567890",
  "balance": 145000
}
  ```
## –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

- Docker –∏ Docker Compose (–≤–µ—Ä—Å–∏—è 3.8+)

---

## –®–∞–≥ 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ `.env` –ø–æ –ø–æ–¥–æ–±–∏—é .env_example

> –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥ –≤–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

---

## –®–∞–≥ 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `docker-compose.yml`


–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö Redis:

redis-cache ‚Äî –¥–ª—è –∫—ç—à–∞ Django

redis-celery ‚Äî –¥–ª—è –±—Ä–æ–∫–µ—Ä–∞ –∑–∞–¥–∞—á Celery

–°–µ—Ä–≤–∏—Å—ã:

postgresql-service ‚Äî PostgreSQL 17

redis-cache ‚Äî Redis –¥–ª—è Django-–∫—ç—à–∞ (–ø–æ—Ä—Ç 6380)

redis-celery ‚Äî Redis –¥–ª—è Celery (–ø–æ—Ä—Ç 6379)

minio-s3-srv ‚Äî S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

backend-django-main-app-service ‚Äî Django-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

celery-worker ‚Äî Celery worker

celery-beat ‚Äî Celery beat

flower ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Celery

---

## –®–∞–≥ 3. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

–í –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
docker-compose up -d --build
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –∏ –∑–∞–ø—É—Å—Ç–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

```bash
docker-compose ps
```

---

## –®–∞–≥ 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MinIO

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å MinIO –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:9001
2. –í–≤–µ–¥–∏—Ç–µ credentials –∏–∑ `.env`.
3. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∫–µ—Ç —Å –∏–º–µ–Ω–µ–º `s3bucket` –∏ —Å–¥–µ–ª–∞–π—Ç–µ –µ–≥–æ –ø—É–±–ª–∏—á–Ω—ã–º.

---

## –®–∞–≥ 5. –ü–µ—Ä–≤–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Django

1. –°–æ–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã:

    ```bash
    docker-compose exec backend-django-main-app-service python manage.py collectstatic
    ```

2. –°–æ–∑–¥–∞–π—Ç–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

    ```bash
    docker-compose exec backend-django-main-app-service python manage.py createsuperuser
    ```

---

## –®–∞–≥ 6. –î–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–º –ø–∞–Ω–µ–ª—è–º

- **Admin**: http://localhost:8000/admin/

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —á–µ—Ä–µ–∑ —á–µ—Ä–µ–∑ Celery.
- –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∞–ø–∏ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –ø–æ api/v1/swagger/
- webhook/bank/imitation/ —á–µ—Ä–µ–∑ —ç—Ç–æ—Ç —ç–Ω–¥–ø–æ–π–Ω—Ç –º–æ–¥–Ω–æ –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å –æ—Ç –±–∞–Ω–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—Å—å—è –≤–µ–±—Ö—É–∫–æ–º.

---

**–£—Å–ø–µ—à–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–µ–∫—Ç–æ–º!**

